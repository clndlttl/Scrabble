<div class="maincolumn">

  <div class="flexrow softbox whitebg">

    <div class>
      {% for letter in current_user.username %}
      <img class="left" src="{{ tiles.getURL(letter) }}">
      {% endfor %}
    </div> 
 
    <a href="{{ url_for('main.createGame') }}"><i class="icon turq fa-regular fa-square-plus fa-2x"></i></a>
 
    <a href="{{ url_for('main.logout') }}"><i class="icon turq fa-solid fa-arrow-right-from-bracket fa-2x"></i></a>
 
  </div>

  <div class="spacer"></div>

  <div class="softbox whitebg">
    {% if pending %}
    <p class="label">You're invited to join these games:</p>
    {% endif %}

    {% for game in pending %}
    <div class="invite">
      <p class="players"><b>Opponent: </b>
        {% if game.player1 == current_user.id %}
        {{ getUsername( game.player2 ) }}
        {% else %}
        {{ getUsername( game.player1 ) }}
        {% endif %}
      </p>   

      <div class="flexrow">
        <p class="gamename"><i>"{{ game.name }}"</i></p>
        <p>created {{ game.printElapsedTime() }}</p>
        <button class="joinbtn" onclick="joinGame('{{ game.id }}')">Join</button>
      </div>
    </div>

    <div class="spacer"></div>

    {% endfor %}
  </div>

  <div class="spacer"></div>

  <div class="softbox whitebg">
    {% if accepted %}
    <p class="label">Your active games:</p>
    {% endif %}

    {% for game in accepted %}

    <div class="game" onclick="showBoard('{{ game.id }}')">
      <p class="players"><b>Opponent: </b>
        {% if game.player1 == current_user.id %}
        {{ getUsername( game.player2 ) }}
        {% else %}
        {{ getUsername( game.player1 ) }}
        {% endif %}
      </p>

      <div class="flexrow">
        <p class="gamename"><i>"{{ game.name }}"</i></p>
      
        <p>created {{ game.printElapsedTime() }}</p>
        
        {% if game.winner == current_user.id %}
        <p class="urgent">You have won!</p>
        {% elif game.winner %}
        <p>{{ getUsername(game.winner) }} has won</p>
        {% elif game.whosUp == current_user.id %}
        <p class="urgent">Your turn!</p>
        {% else %}
        <p>{{ getUsername( game.whosUp ) }}'s turn</p>
        {% endif %}
      
        <p>{{ strlen( game.pool ) }} letters left</p>
      </div>

      {% if game.isComplete and game.winner == current_user.id %}
      <button class="deleteGameBtn" onclick="deleteGame('{{ game.id }}')">Delete Game</button>
      {% endif %}

    </div>

    <div class="spacer"></div>

    {% endfor %}
  </div>

  {% include "_get_flash.html" %}
</div> 


<script>
  function joinGame(gameId) {
    var fd = new FormData;
    fd.append('game_id', gameId);
    
    $.ajax({
      url: "{{ url_for('main.joinGame') }}",
      type: 'POST',
      processData: false,
      contentType: false,
      dataType: 'html',
      data: fd,
      success: function(data, textStatus) {
        $('#_main').html(data);
      }
    });
  }
  function deleteGame(gameId) {
    var fd = new FormData;
    fd.append('game_id', gameId);

    $.ajax({
      url: "{{ url_for('main.deleteGame') }}",
      type: 'POST',
      processData: false,
      contentType: false,
      dataType: 'html',
      data: fd,
      success: function(data, textStatus) {
        $('#_main').html(data);
      }     
    });
  }
</script>